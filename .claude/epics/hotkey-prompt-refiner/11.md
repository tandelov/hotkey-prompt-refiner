---
name: Configuration System
status: completed
created: 2025-10-04T15:52:52Z
updated: 2025-10-04T21:45:00Z
github: https://github.com/tandelov/hotkey-prompt-refiner/issues/11
depends_on: [8]
parallel: true
conflicts_with: []
---

# Task: Configuration System

## Description
Implement configuration loading for API key (from environment or .env file) and prompt template (from external config file). Validate configuration on startup and provide clear error messages for missing/invalid configuration.

## Acceptance Criteria
- [ ] Load API key from ANTHROPIC_API_KEY environment variable
- [ ] Fallback to .env file if environment variable not set
- [ ] Load prompt template from external config file (prompt_template.txt)
- [ ] Validate configuration on startup
- [ ] Clear error messages for missing API key or prompt template
- [ ] Default prompt template if file doesn't exist

## Technical Details
**Implementation approach:**
- Use `dotenv` crate for .env file loading
- Create `Config` struct to hold all configuration
- Load on startup, fail fast if required config missing
- Provide sensible defaults for prompt template

**Code structure:**
```rust
// src/config.rs
pub struct Config {
    pub api_key: String,
    pub prompt_template: String,
}

impl Config {
    pub fn load() -> Result<Self, ConfigError>
}
```

**Default prompt template:**
```
Refine and improve the following prompt to be more clear, concise, and effective:

{clipboard_text}

Provide only the refined prompt without explanation.
```

**Configuration locations:**
- API key: `ANTHROPIC_API_KEY` env var or `.env` file
- Prompt template: `prompt_template.txt` in current directory or config dir

## Dependencies
- [ ] Task 8 (Project Setup) must be complete
- [ ] `dotenv` crate available

## Effort Estimate
- Size: S
- Hours: 3-4 hours
- Parallel: true (can develop alongside other components)

## Definition of Done
- [ ] API key loaded successfully from environment or .env
- [ ] Prompt template loaded from file or defaults to built-in
- [ ] Clear error messages if API key missing
- [ ] Configuration validated on startup
- [ ] Unit tests for config loading
