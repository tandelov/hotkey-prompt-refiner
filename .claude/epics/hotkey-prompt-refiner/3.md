---
name: Auto-paste System
status: open
created: 2025-10-04T15:52:52Z
updated: 2025-10-04T17:20:16Z
github: https://github.com/tandelov/hotkey-prompt-refiner/issues/3
depends_on: [8]
parallel: true
conflicts_with: []
---

# Task: Auto-paste System

## Description
Implement keyboard simulation to automatically paste API response text at the current cursor location. Use platform-specific implementations for reliable pasting, with clipboard fallback if direct paste fails.

## Acceptance Criteria
- [ ] Successfully simulate keyboard input to paste text at cursor
- [ ] Works reliably on macOS (primary target)
- [ ] Fallback to clipboard if paste simulation fails
- [ ] Handle special characters and multi-line text correctly
- [ ] Detect and report if Accessibility permissions missing (macOS)
- [ ] Clear user feedback if paste fails

## Technical Details
**Implementation approach:**
- Use `enigo` crate for keyboard simulation
- Implement platform-specific paste mechanisms
- Primary: Simulate Cmd+V (macOS) or Ctrl+V (Windows/Linux)
- Fallback: Copy response to clipboard and notify user
- Check for Accessibility permissions on macOS

**Code structure:**
```rust
// src/paste_handler.rs
pub struct PasteHandler;

impl PasteHandler {
    pub fn paste_text(text: &str) -> Result<(), PasteError>
    pub fn check_permissions() -> bool // macOS only
}
```

**Platform-specific considerations:**
- macOS: Requires Accessibility permissions for keystroke simulation
- Must put text in clipboard first, then simulate Cmd+V
- Handle text encoding (UTF-8) properly
- Consider delay between clipboard set and paste (5-10ms)

**Fallback strategy:**
If paste fails:
1. Put response in clipboard
2. Show notification: "Response copied to clipboard. Press Cmd+V to paste."

## Dependencies
- [ ] Task 8 (Project Setup) - enigo crate available
- [ ] macOS Accessibility permissions (user must grant)

## Effort Estimate
- Size: M
- Hours: 6-8 hours
- Parallel: true (can develop independently)

## Definition of Done
- [ ] Text successfully pasted at cursor location on macOS
- [ ] Fallback to clipboard works if paste fails
- [ ] Accessibility permission check implemented
- [ ] Manual testing confirms reliable pasting
- [ ] Special characters and newlines handled correctly
