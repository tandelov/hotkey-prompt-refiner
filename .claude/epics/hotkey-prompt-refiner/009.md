---
name: Performance Optimization
status: open
created: 2025-10-04T15:52:52Z
updated: 2025-10-04T15:52:52Z
github: [Will be updated when synced to GitHub]
depends_on: [007]
parallel: true
conflicts_with: []
---

# Task: Performance Optimization

## Description
Optimize the application to meet strict performance requirements: binary size <5MB, memory usage <30MB idle, CPU usage <1% idle, and hotkey-to-API-call latency <200ms. Profile and optimize code, dependencies, and build configuration.

## Acceptance Criteria
- [ ] Release binary size under 5MB
- [ ] Idle memory usage under 30MB
- [ ] Idle CPU usage under 1%
- [ ] Hotkey press to API call start latency under 200ms
- [ ] No memory leaks during extended operation
- [ ] Performance benchmarks documented

## Technical Details
**Optimization strategies:**

**Binary Size (<5MB):**
- Already configured: opt-level="z", lto=true, strip=true
- Review dependencies - remove unused features
- Consider `cargo-bloat` to identify large dependencies
- Use `cargo-strip` if needed
- Minimize tokio features (only runtime, no full)

**Memory Usage (<30MB):**
- Profile with `cargo instruments` or `heaptrack`
- Avoid unnecessary allocations
- Use string slices where possible
- Minimize dependency footprint
- Consider lazy_static for globals

**CPU Usage (<1%):**
- Ensure hotkey event loop is efficient
- No busy-waiting or polling
- Async runtime should idle properly
- Profile for unexpected background activity

**Latency (<200ms):**
- Minimize work before API call starts
- Optimize clipboard read performance
- Fast prompt formatting (string interpolation)
- Measure and log timing at each stage

**Profiling tools:**
- `cargo bloat` - binary size analysis
- `cargo instruments` (macOS) - CPU/memory profiling
- Manual timing with `Instant::now()`
- Memory usage: Activity Monitor / htop

## Dependencies
- [ ] Task 007 (Complete Workflow) - must have working implementation to optimize

## Effort Estimate
- Size: M
- Hours: 6-8 hours
- Parallel: true (can do alongside cross-platform testing)

## Definition of Done
- [ ] All performance benchmarks met and documented
- [ ] Binary size verified: <5MB on release build
- [ ] Memory usage verified: <30MB during idle operation
- [ ] CPU usage verified: <1% when not processing
- [ ] Latency verified: <200ms from hotkey to API call
- [ ] Performance metrics added to README
- [ ] No memory leaks after 1 hour continuous operation
