---
name: Global Hotkey System
status: open
created: 2025-10-04T15:52:52Z
updated: 2025-10-04T17:19:50Z
github: https://github.com/tandelov/hotkey-prompt-refiner/issues/9
depends_on: [8]
parallel: false
conflicts_with: []
---

# Task: Global Hotkey System

## Description
Implement cross-platform global hotkey registration with special handling for macOS main thread requirements. The hotkey should trigger a callback function that will orchestrate the clipboard → API → paste workflow.

## Acceptance Criteria
- [ ] Global hotkey registered successfully (default: Cmd+Shift+P on macOS, Ctrl+Shift+P on Windows/Linux)
- [ ] Hotkey event loop runs on main thread (macOS requirement)
- [ ] Hotkey activation triggers callback function
- [ ] Clean startup/shutdown with proper resource cleanup
- [ ] Clear console message confirming hotkey registration
- [ ] Graceful error handling if hotkey registration fails

## Technical Details
**Implementation approach:**
- Use `global-hotkey` crate for cross-platform support
- Run event loop on main thread (critical for macOS)
- Spawn async runtime on separate thread for non-blocking operations
- Use channel (mpsc) to communicate between hotkey callback and async runtime

**Key considerations:**
- macOS requires hotkey event loop on main thread
- Callback must be fast and non-blocking
- Handle hotkey already registered by another app

**Code structure:**
```rust
// src/hotkey_manager.rs
pub struct HotkeyManager {
    // Handle hotkey registration and event loop
}

impl HotkeyManager {
    pub fn register() -> Result<Self>
    pub fn run_event_loop() // Blocks on main thread
}
```

## Dependencies
- [ ] Task 8 (Project Setup) must be complete
- [ ] `global-hotkey` crate available

## Effort Estimate
- Size: M
- Hours: 6-8 hours
- Parallel: false (required for all downstream tasks)

## Definition of Done
- [ ] Hotkey registers successfully on macOS
- [ ] Callback function invoked when hotkey pressed
- [ ] Event loop runs on main thread without blocking
- [ ] Manual testing confirms hotkey works system-wide
- [ ] Error messages clear if registration fails
