---
name: History viewer and in-memory storage
status: open
created: 2025-10-05T19:47:36Z
updated: 2025-10-05T19:51:23Z
github: https://github.com/tandelov/hotkey-prompt-refiner/issues/18
depends_on: [20, 17]
parallel: false
conflicts_with: []
---

# Task: History viewer and in-memory storage

## Description

Build a comprehensive history viewing system with search/filter capabilities using Svelte stores for in-memory data management. Create UI components for displaying processing history, including original text, AI response, template used, and timestamps. Implement copy-to-clipboard functionality from history entries. This feature enables users to review past AI processing operations and reuse outputs without reprocessing.

## Acceptance Criteria

- [ ] In-memory history store implemented using Svelte writable store
- [ ] History component displays list of past processing operations (most recent first)
- [ ] Search/filter functionality by text content, template name, or date range
- [ ] Individual history items show: timestamp, template name, input preview, output preview
- [ ] Click-to-expand full input/output text
- [ ] Copy-to-clipboard button for each history entry output
- [ ] History persists during app session but clears on app restart (in-memory only)

## Technical Details

**Files to create:**
- `/root/hotkey-prompt-refiner/src/lib/stores/historyStore.ts` - Svelte writable store for history data
- `/root/hotkey-prompt-refiner/src/lib/components/History.svelte` - Main history view component
- `/root/hotkey-prompt-refiner/src/lib/components/HistoryItem.svelte` - Individual history entry component
- `/root/hotkey-prompt-refiner/src/routes/history/+page.svelte` - History route page

**Files to modify:**
- `/root/hotkey-prompt-refiner/src/lib/components/Sidebar.svelte` - Add History navigation link

**Implementation approach:**
1. **History Store Structure:**
```typescript
interface HistoryEntry {
  id: string;
  timestamp: number;
  template_id: string;
  template_name: string;
  input_text: string;
  output_text: string;
  model: string;
}

// Svelte store
export const historyStore = writable<HistoryEntry[]>([]);
export const addHistoryEntry = (entry: Omit<HistoryEntry, 'id'>) => {...};
export const clearHistory = () => {...};
export const searchHistory = (query: string) => {...};
```

2. **Listen to API events from Task 17:**
   - Subscribe to `api_complete` events
   - Auto-populate history store when API responses arrive
   - Extract template name from config

3. **History UI Features:**
   - Virtualized list for performance with large histories (use svelte-virtual)
   - Date grouping (Today, Yesterday, Last 7 days, Older)
   - Search bar with debounced input
   - Filter dropdown (by template)
   - Expandable accordion items

4. **Copy functionality:**
   - Use Tauri clipboard command from Task 17
   - Show toast notification on successful copy
   - Copy button on hover for each entry

**Component hierarchy:**
```
history/+page.svelte
  └─ History.svelte
       ├─ SearchBar.svelte
       ├─ FilterDropdown.svelte
       └─ HistoryItem.svelte (multiple instances)
            └─ CopyButton.svelte
```

## Dependencies

- [ ] Task 20: UI shell and navigation (provides Sidebar and routing)
- [ ] Task 17: API integration (provides `api_complete` events and clipboard commands)
- [ ] Svelte stores documentation
- [ ] Optional: `svelte-virtual` for list virtualization

## Effort Estimate

**Size:** L
**Hours:** 12-16
**Parallel:** false (blocked by Task 20 and Task 17)

## Definition of Done

- [ ] Code implemented and passes all tests
- [ ] Unit tests for history store operations (add, search, filter, clear)
- [ ] Component tests for History.svelte and HistoryItem.svelte
- [ ] Integration test: API event → history store → UI update
- [ ] Accessibility tests (keyboard navigation, screen reader support)
- [ ] Performance test with 100+ history entries
- [ ] Search and filter functionality working correctly
- [ ] Copy-to-clipboard functionality verified on all platforms
- [ ] Documentation updated (store API, component props)
- [ ] Code reviewed and approved
- [ ] Visual design matches app theme
