---
name: Build, test, and distribution setup
status: open
created: 2025-10-05T19:47:36Z
updated: 2025-10-05T19:51:23Z
github: https://github.com/tandelov/hotkey-prompt-refiner/issues/16
depends_on: [20, 21, 22, 15, 17, 18, 19, 13, 14]
parallel: false
conflicts_with: []
---

# Task: Build, test, and distribution setup

## Description

Configure production build pipeline, distribution packaging (macOS .dmg, Linux AppImage), and comprehensive testing suite. Perform performance testing and optimization to meet targets (< 50 MB idle memory, < 500ms load time). Create integration tests for the complete hotkey → API → paste workflow. Document installation process for end users.

## Acceptance Criteria

- [ ] macOS .dmg bundle configured and builds successfully
- [ ] Linux AppImage bundle configured and builds successfully
- [ ] Performance targets met: < 50 MB idle memory, < 500ms app load time
- [ ] Integration tests cover hotkey → clipboard → API → paste flow
- [ ] Installation documentation created for macOS and Linux
- [ ] CI/CD pipeline configured for automated builds (optional but recommended)

## Technical Details

**Implementation Approach:**
- Configure Tauri bundler in `tauri.conf.json` for DMG and AppImage
- Use `cargo-bundle` for platform-specific packaging
- Performance profiling with `cargo instruments` (macOS) and `valgrind` (Linux)
- Integration tests using Tauri's testing framework
- GitHub Actions workflow for multi-platform builds

**Files Affected:**
- `src-tauri/tauri.conf.json` - Bundle configuration (DMG, AppImage targets)
- `.github/workflows/build.yml` (new) - CI/CD pipeline
- `src-tauri/tests/integration_test.rs` (new) - End-to-end tests
- `docs/INSTALLATION.md` (new) - User installation guide
- `src-tauri/Cargo.toml` - Release profile optimizations
- `scripts/benchmark.sh` (new) - Performance testing script

**Build Configuration:**
- macOS: .dmg with code signing (if certificates available)
- Linux: AppImage with embedded dependencies
- Optimization flags: `lto = true`, `codegen-units = 1`, `opt-level = "z"`

**Performance Optimization:**
- Binary size: Strip symbols, minimize dependencies
- Memory: Lazy loading, efficient state management
- Load time: Reduce bundle size, optimize initialization

**Integration Tests:**
1. Register hotkey programmatically
2. Simulate clipboard content
3. Trigger hotkey event
4. Verify API call made with correct payload
5. Mock API response
6. Verify auto-paste occurred

**Distribution Artifacts:**
- `hotkey-prompt-refiner-{version}-macos.dmg`
- `hotkey-prompt-refiner-{version}-linux-x86_64.AppImage`
- Checksums and release notes

## Dependencies

- [x] Task 20: Basic Tauri UI shell
- [x] Task 21: Backend config system
- [x] Task 22: Settings UI
- [x] Task 15: Hotkey registration/management
- [x] Task 17: API integration and response handling
- [x] Task 18: History tracking
- [x] Task 19: Menu bar/system tray
- [x] Task 13: Migration logic
- [x] Task 14: Auto-launch and platform features
- [ ] Code signing certificates (macOS, optional)
- [ ] GitHub release workflow configured

## Effort Estimate

**Size:** L
**Hours:** 16-24
**Parallel:** false (must wait for all core features to be complete)

## Definition of Done

- [ ] Code implemented and committed
- [ ] Integration tests passing on all platforms
- [ ] Performance benchmarks meet targets (documented results)
- [ ] macOS .dmg builds and installs successfully
- [ ] Linux AppImage builds and runs successfully
- [ ] Installation documentation complete and tested
- [ ] Code review completed
- [ ] Manual QA testing completed (full workflow on each platform)
- [ ] Release artifacts generated and uploaded to GitHub Releases
- [ ] Binary sizes documented (should be < 10 MB for optimized builds)
- [ ] Memory usage verified under load (multiple API calls)
- [ ] No memory leaks detected (24+ hour run test)
