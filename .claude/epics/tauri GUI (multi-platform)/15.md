---
name: Hotkey system integration
status: open
created: 2025-10-05T19:47:36Z
updated: 2025-10-05T19:51:23Z
github: https://github.com/tandelov/hotkey-prompt-refiner/issues/15
depends_on: [21]
parallel: true
conflicts_with: []
---

# Task: Hotkey system integration

## Description

Adapt the existing global hotkey manager to work with Tauri's event loop architecture, enabling multi-template hotkey support with conflict detection. The current implementation in `src/hotkey_manager.rs` uses a blocking event loop on the main thread (required for macOS). This needs to be refactored to work with Tauri's async event system while maintaining cross-platform compatibility and the ability to register multiple hotkeys for different prompt templates.

## Acceptance Criteria

- [ ] Existing hotkey manager successfully integrated with Tauri event loop without blocking UI
- [ ] Multi-template hotkey registration system implemented (support 3+ simultaneous hotkeys)
- [ ] Hotkey conflict detection prevents duplicate registrations
- [ ] Platform-specific behavior preserved (macOS Accessibility permissions, Windows/Linux standard registration)
- [ ] Tauri events emitted when hotkeys are triggered (`hotkey_triggered` with template ID)

## Technical Details

**Files to modify:**
- `/root/hotkey-prompt-refiner/src/hotkey_manager.rs` - Refactor to support Tauri event system
- `/root/hotkey-prompt-refiner/src-tauri/src/main.rs` - Add Tauri command handlers for hotkey management
- Create `/root/hotkey-prompt-refiner/src-tauri/src/hotkey.rs` - Tauri-specific hotkey integration layer

**Implementation approach:**
1. Extract hotkey registration logic from blocking event loop
2. Create Tauri command: `register_hotkey(template_id, key_code, modifiers)`
3. Implement conflict detection using HashMap<HotKey, TemplateId>
4. Use Tauri's async event emitter to send hotkey events to frontend
5. Maintain existing platform-specific modifier handling (Cmd/Super vs Ctrl)
6. Add unregister_hotkey command for dynamic management

**Key considerations:**
- macOS requires main thread for event processing - investigate Tauri's approach
- Event channel communication between hotkey thread and Tauri async runtime
- Thread-safe hotkey registry with Arc<Mutex<>>
- Proper cleanup on app exit (unregister all hotkeys)

## Dependencies

- [ ] Task 21: Backend config system (for loading hotkey configurations)
- [ ] `global_hotkey` crate (already in use)
- [ ] Tauri event system and commands

## Effort Estimate

**Size:** M
**Hours:** 8-12
**Parallel:** true (can run in parallel with Task 17)

## Definition of Done

- [ ] Code implemented and passes all tests
- [ ] Unit tests for hotkey registration, conflict detection, and multi-template support
- [ ] Integration test with Tauri event system
- [ ] Platform-specific tests (macOS, Windows, Linux)
- [ ] Documentation updated (API commands, event payloads)
- [ ] Code reviewed and approved
- [ ] No regressions in existing hotkey functionality
