---
name: Migration logic and backward compatibility
status: open
created: 2025-10-05T19:47:36Z
updated: 2025-10-05T19:51:23Z
github: https://github.com/tandelov/hotkey-prompt-refiner/issues/13
depends_on: [21, 22]
parallel: true
conflicts_with: []
---

# Task: Migration logic and backward compatibility

## Description

Build migration system to detect and import existing CLI configuration (.env files) into the new Tauri GUI application. Create a user-friendly migration dialog that auto-imports API keys, hotkey bindings, and prompt templates from the existing CLI setup. Support various configuration scenarios and edge cases.

## Acceptance Criteria

- [ ] Detection of existing .env file in project directory or user home
- [ ] Migration dialog UI shows detected settings with preview
- [ ] Auto-import of ANTHROPIC_API_KEY, hotkey bindings, and prompt templates
- [ ] Tested with 10+ different .env file scenarios (empty, partial, complete, invalid)
- [ ] User can choose to skip migration or manually edit before importing
- [ ] Migration only triggers once (flag stored to prevent repeated prompts)

## Technical Details

**Implementation Approach:**
- Migration check runs on first app launch
- Parse .env files using `dotenv` crate or manual regex parsing
- Store migration completion flag in `config.toml` or app data directory
- Migration dialog built with React/Tauri dialog components
- Validation of imported values before saving to config

**Files Affected:**
- `src-tauri/src/migration.rs` (new) - Migration logic
- `src-tauri/src/config.rs` - Config loading with migration check
- `src/components/MigrationDialog.tsx` (new) - Migration UI
- `src-tauri/src/main.rs` - Migration trigger on startup
- `src-tauri/Cargo.toml` - Add parsing dependencies if needed

**Migration Detection:**
1. Check for `.env` in project root
2. Check for `.env` in user home directory
3. Check for `~/.hotkey-prompt-refiner/.env`
4. Parse and extract: `ANTHROPIC_API_KEY`, `HOTKEY_*`, `PROMPT_TEMPLATE`

**Test Scenarios:**
- Empty .env
- Only API key
- API key + hotkeys
- Complete configuration
- Invalid/malformed .env
- Missing .env
- Multiple .env files in different locations
- Corrupted values
- Very large prompt templates
- Special characters in values

## Dependencies

- [x] Task 21: Backend config system (to save migrated settings)
- [x] Task 22: Settings UI (dialog components reusable for migration)
- [ ] .env file parser implementation
- [ ] Migration flag storage mechanism

## Effort Estimate

**Size:** M
**Hours:** 10-14
**Parallel:** true (can run alongside Task 19)

## Definition of Done

- [ ] Code implemented and committed
- [ ] Unit tests for all 10+ migration scenarios
- [ ] Integration tests for end-to-end migration flow
- [ ] Migration dialog UI implemented and styled
- [ ] Edge cases handled gracefully (file permissions, invalid formats)
- [ ] Documentation updated (migration guide for CLI users)
- [ ] Code review completed
- [ ] Manual testing with real .env files from CLI version
- [ ] Migration can be manually triggered from settings (for re-import)
