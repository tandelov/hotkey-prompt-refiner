---
name: Clipboard and API integration
status: open
created: 2025-10-05T19:47:36Z
updated: 2025-10-05T19:51:23Z
github: https://github.com/tandelov/hotkey-prompt-refiner/issues/17
depends_on: [21]
parallel: true
conflicts_with: []
---

# Task: Clipboard and API integration

## Description

Expose existing clipboard operations and Anthropic API client as Tauri commands, enabling the frontend to trigger AI processing workflows. Connect the existing `src/clipboard.rs` and `src/anthropic.rs` modules to Tauri's command system with proper error handling and status event emission. Implement event streaming to provide real-time feedback to the UI during API processing (triggered, processing, complete/error states).

## Acceptance Criteria

- [ ] Clipboard operations exposed via Tauri commands (`get_clipboard_text`, `set_clipboard_text`)
- [ ] API processing available as Tauri command (`process_with_ai(template_id, text)`)
- [ ] Status events emitted at each workflow stage: `hotkey_triggered`, `api_processing`, `api_complete`, `api_error`
- [ ] Existing clipboard error handling properly mapped to Tauri error responses
- [ ] API responses include metadata (model used, token count if available)

## Technical Details

**Files to modify:**
- `/root/hotkey-prompt-refiner/src/clipboard.rs` - Ensure compatibility with Tauri async commands
- `/root/hotkey-prompt-refiner/src/anthropic.rs` - Adapt for Tauri command usage
- `/root/hotkey-prompt-refiner/src-tauri/src/main.rs` - Register Tauri commands
- Create `/root/hotkey-prompt-refiner/src-tauri/src/commands.rs` - Tauri command implementations

**Implementation approach:**
1. Create Tauri command wrappers around ClipboardHandler methods
2. Create Tauri command for `process_text(template_id, clipboard_text)`
3. Implement event emitter pattern:
   - `emit("hotkey_triggered", { template_id })`
   - `emit("api_processing", { template_id, text_length })`
   - `emit("api_complete", { template_id, response_text })`
   - `emit("api_error", { template_id, error_message })`
4. Add proper async error conversion from ClipboardError and ApiError to Tauri errors
5. Load API key and config from backend config system (Task 21 dependency)

**Event payload structures (TypeScript types for frontend):**
```typescript
interface HotkeyTriggeredEvent {
  template_id: string;
  timestamp: number;
}

interface ApiProcessingEvent {
  template_id: string;
  text_length: number;
  timestamp: number;
}

interface ApiCompleteEvent {
  template_id: string;
  response_text: string;
  model: string;
  timestamp: number;
}

interface ApiErrorEvent {
  template_id: string;
  error: string;
  timestamp: number;
}
```

## Dependencies

- [ ] Task 21: Backend config system (for loading API keys and template configurations)
- [ ] Existing `src/clipboard.rs` and `src/anthropic.rs` modules
- [ ] `tauri::command` and `tauri::Manager` for event emission

## Effort Estimate

**Size:** M
**Hours:** 6-10
**Parallel:** true (can run in parallel with Task 15)

## Definition of Done

- [ ] Code implemented and passes all tests
- [ ] Unit tests for all Tauri commands
- [ ] Integration tests for full workflow (clipboard -> API -> event emission)
- [ ] Error handling tests (clipboard errors, API errors, network failures)
- [ ] TypeScript type definitions generated for frontend
- [ ] Documentation updated (command signatures, event payloads)
- [ ] Code reviewed and approved
- [ ] Manual testing on all platforms (macOS, Windows, Linux)
